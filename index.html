<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>Algorithm Time Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 900px;
            margin: auto;
        }
        textarea {
            width: 100%;
            height: 260px;
        }
        button {
            margin-top: 10px;
            margin-right: 6px;
            padding: 8px 16px;
            cursor: pointer;
        }
        label {
            display: block;
            margin-bottom: 8px;
        }
        input, select {
            margin-left: 6px;
        }
    </style>
</head>
<body>

    <h1>Algorithm Time Simulator (ms)</h1>

    <p><strong>Settings:</strong></p>

    <label>
        Population size:
        <input type="number" id="population" value="1000000">
    </label>

    <label>
        Margin of error (%):
        <input type="number" id="error" value="4">
    </label>

    <label>
        Confidence level:
        <select id="confidence">
            <option value="1.96" selected>95%</option>
            <option value="2.58">99%</option>
        </select>
    </label>

    <label>
        Estimated proportion (p):
        <input type="number" id="proportion" value="50">
    </label>

    <hr>

    <label>
        Mean:
        <input type="number" id="mean" value="500">
    </label>

    <label>
        Standard deviation:
        <input type="number" id="stddev" value="50">
    </label>

    <label>
        Decimal places:
        <input type="number" id="decimals" value="2" min="0">
    </label>

    <label>
        Sample size:
        <input type="number" id="sample" value="600" min="1">
    </label><br>

    <button onclick="calculateSample()">Suggest sample size</button>
    <button onclick="generateTimes()">Generate times</button>
    <button onclick="copyResult()">Copy</button>
    <button onclick="downloadCSV()">Download CSV</button>

    <h3>Result:</h3>
    <textarea id="result" readonly></textarea>

    <script>
        function calculateSample() {
            const N = parseInt(document.getElementById('population').value);
            const z = parseFloat(document.getElementById('confidence').value);
            const e = parseFloat(document.getElementById('error').value) / 100;
            const p = parseFloat(document.getElementById('proportion').value) / 100;

            if (N <= 0 || e <= 0 || p <= 0 || p >= 1) {
                alert('Please check the values used to calculate the sample size.');
                return;
            }

            const n0 = (Math.pow(z, 2) * p * (1 - p)) / Math.pow(e, 2);
            const n = n0 / (1 + (n0 - 1) / N);
            const nFinal = Math.ceil(n);

            document.getElementById('sample').value = nFinal;
        }

        function randomNormal(mean, stddev) {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v) * stddev + mean;
        }

        function generateTimes() {
            const mean = parseFloat(document.getElementById('mean').value);
            const stddev = parseFloat(document.getElementById('stddev').value);
            const sample = parseInt(document.getElementById('sample').value);
            const decimals = parseInt(document.getElementById('decimals').value);

            if (!sample || sample <= 0) {
                alert('Please enter a valid sample size.');
                return;
            }

            let times = [];
            const factor = Math.pow(10, decimals);

            for (let i = 0; i < sample; i++) {
                let time = randomNormal(mean, stddev);
                time = Math.max(time, 0);
                time = Math.round(time * factor) / factor;
                times.push(time.toFixed(decimals));
            }

            document.getElementById('result').value = times.join(", ");
        }

        function copyResult() {
            const text = document.getElementById('result');
            text.select();
            text.setSelectionRange(0, 99999);
            document.execCommand('copy');
            alert('Copied to clipboard!');
        }

        function downloadCSV() {
            const data = document.getElementById('result').value;
            if (!data) {
                alert('Generate the times before downloading.');
                return;
            }

            const lines = "Time (ms)\n" + data.split(", ").join("\n");
            const blob = new Blob([lines], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = 'times.csv';
            a.click();

            URL.revokeObjectURL(url);
        }
    </script>

</body>
</html>
